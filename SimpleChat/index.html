<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CyberChat</title>
    <!-- 引入Vue.js -->
    <script src="https://unpkg.com/vue@3.5.12/dist/vue.global.prod.js"></script>

    <!-- 引入图标字体（这里使用示例链接，需要替换成实际的图标库） -->
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_8d5l8fzk5b87iudi.css">

    <!-- 引入样式文件 -->
    <link rel="stylesheet" href="style.css?v=1.0.8">
</head>

<body>
    <div id="app">
        <div class="wechat-container">
            <!-- 主页面 -->
            <div class="page main-page" :class="{ 'slide-out': showChat }">
                <!-- 顶部状态栏 -->
                <div class="header">
                    <div class="title">{{ getCurrentTabName }}</div>
                    <div class="icons">
                        <i class="icon-search"></i>
                        <i class="icon-add"></i>
                    </div>
                </div>



                <!-- 聊天列表页面 -->
                <div v-if="currentTab === 'wechat'" class="chat-list">
                    <div class="chat-item" v-for="chat in chats" :key="chat.id" @click="openChat(chat)">
                        <div class="avatar">
                            <img :src="chat.avatar" alt="头像">
                        </div>
                        <div class="content">
                            <div class="name">{{chat.name}}</div>
                            <div class="message">{{chat.lastMessage}}</div>
                        </div>
                        <div class="time">{{chat.time}}</div>
                        <div v-if="chat.unread" class="badge" :class="{ 'large': chat.unread > 99 }">
                            {{ chat.unread > 99 ? '99+' : chat.unread }}
                        </div>
                    </div>
                </div>

                <!-- 通讯录页面 -->
                <div v-if="currentTab === 'contacts'" class="contacts-page">
                    <!-- 搜索框容器 -->
                    <div class="search-container">
                        <div class="search-box">
                            <i class="icon-search"></i>
                            <input type="text" v-model="searchText" placeholder="搜索" @input="handleSearch">
                        </div>
                    </div>

                    <!-- 添加搜索结果显示区域 -->
                    <div class="search-results" v-if="searchText && searchResults.length">
                        <div class="contact-item" v-for="contact in searchResults" :key="contact.id"
                            @click="openContactDetail(contact)">
                            <div class="avatar">
                                <img :src="contact.avatar" alt="头像">
                            </div>
                            <div class="name">{{contact.name}}</div>
                        </div>
                    </div>

                    <!-- 原联系人列表，当没有搜索文本时显示 -->
                    <div class="contact-list" v-show="!searchText">
                        <!-- 特殊联系人 -->
                        <div class="special-contacts">
                            <div class="contact-item">
                                <div class="avatar special-avatar green-bg">
                                    <img src="https://api.iconify.design/material-symbols:person-add.svg?color=white&width=15"
                                        alt="新的朋友" class="icon-new-friend">
                                </div>
                                <div class="name">新的朋友</div>
                            </div>
                            <div class="contact-item">
                                <div class="avatar special-avatar green-bg">
                                    <img src="https://api.iconify.design/material-symbols:group.svg?color=white&width=18"
                                        alt="群聊" class="icon-group">
                                </div>
                                <div class="name">群聊</div>
                            </div>
                            <div class="contact-item">
                                <div class="avatar special-avatar green-bg">
                                    <img src="https://api.iconify.design/material-symbols:sell.svg?color=white&width=14"
                                        alt="标签" class="icon-tag">
                                </div>
                                <div class="name">标签</div>
                            </div>
                            <div class="contact-item">
                                <div class="avatar special-avatar green-bg">
                                    <img src="https://api.iconify.design/material-symbols:chrome-reader-mode.svg?color=white&width=16"
                                        alt="公众号" class="icon-official">
                                </div>
                                <div class="name">公众号</div>
                            </div>
                        </div>

                        <!-- 联系人列表 -->
                        <div class="contact-section" v-for="section in contactSections" :key="section.letter"
                            :data-letter="section.letter">
                            <div class="section-title">{{section.letter}}</div>
                            <div class="contact-item" v-for="contact in section.contacts" :key="contact.id"
                                @click="openContactDetail(contact)">
                                <div class="avatar">
                                    <img :src="contact.avatar" alt="头像">
                                </div>
                                <div class="name">{{contact.name}}</div>
                            </div>
                        </div>
                    </div>

                    <!-- 字母索引 -->
                    <div class="letter-index">
                        <span v-for="letter in letters" :key="letter" @click="scrollToLetter(letter)"
                            @touchstart="handleLetterTouchStart($event, letter)" @touchmove.prevent>{{letter}}</span>
                    </div>
                </div>

                <!-- 发现页面 -->
                <div v-if="currentTab === 'discover'" class="discover-page">
                    <div class="discover-list">
                        <!-- 朋友圈和视频号 -->
                        <div class="discover-section">
                            <div class="discover-item" @click="openMoments">
                                <img src="https://api.iconify.design/material-symbols:camera.svg?color=%23FF9C0B"
                                    alt="朋友圈" class="discover-icon">
                                <span>朋友圈</span>
                                <i class="icon-arrow"></i>
                            </div>
                            <div class="discover-item">
                                <img src="https://api.iconify.design/material-symbols:play-circle.svg?color=%23FA9D3B"
                                    alt="频号" class="discover-icon">
                                <span>视频号</span>
                                <i class="icon-arrow"></i>
                            </div>
                        </div>

                        <!-- AI创作能力入口 -->
                        <div class="discover-section">
                            <div class="discover-item" @click="openDrawPage">
                                <img src="https://api.iconify.design/material-symbols:brush.svg?color=%23FF6B6B"
                                    alt="画一画" class="discover-icon">
                                <span>画一画</span>
                                <i class="icon-arrow"></i>
                            </div>
                            <div class="discover-item">
                                <img src="https://api.iconify.design/material-symbols:edit-note.svg?color=%234A90E2"
                                    alt="写一写" class="discover-icon">
                                <span>写一写</span>
                                <i class="icon-arrow"></i>
                            </div>
                            <div class="discover-item">
                                <img src="https://api.iconify.design/material-symbols:music-note.svg?color=%23FFB900"
                                    alt="唱一唱" class="discover-icon">
                                <span>唱一唱</span>
                                <i class="icon-arrow"></i>
                            </div>
                            <div class="discover-item">
                                <img src="https://api.iconify.design/material-symbols:fiber-smart-record.svg?color=%23B066FF"
                                    alt="录一录" class="discover-icon">
                                <span>录一录</span>
                                <i class="icon-arrow"></i>
                            </div>
                        </div>

                        <!-- 扫一扫和摇一摇部分 -->
                        <div class="discover-section">
                            <div class="discover-item">
                                <img src="https://api.iconify.design/material-symbols:qr-code-scanner.svg?color=%2307C160"
                                    alt="扫一扫" class="discover-icon">
                                <span>扫一扫</span>
                                <i class="icon-arrow"></i>
                            </div>
                            <div class="discover-item">
                                <img src="https://api.iconify.design/material-symbols:vibration.svg?color=%2307C160"
                                    alt="摇一摇" class="discover-icon">
                                <span>摇一摇</span>
                                <i class="icon-arrow"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 我的页面 -->
                <div v-if="currentTab === 'me'" class="me-page">
                    <div class="user-info">
                        <div class="avatar">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=User" alt="头像">
                        </div>
                        <div class="info">
                            <div class="name">用户名</div>
                            <div class="wxid">微信号：wxid_xxx</div>
                        </div>
                        <div class="qr-code">
                            <i class="icon-qr"></i>
                        </div>
                        <i class="icon-arrow"></i>
                    </div>
                    <div class="me-section">
                        <div class="me-item">
                            <i class="icon-pay"></i>
                            <span>支付</span>
                            <i class="icon-arrow"></i>
                        </div>
                    </div>
                    <div class="me-section">
                        <div class="me-item">
                            <i class="icon-favorites"></i>
                            <span>收藏</span>
                            <i class="icon-arrow"></i>
                        </div>
                        <div class="me-item">
                            <i class="icon-albums"></i>
                            <span>相册</span>
                            <i class="icon-arrow"></i>
                        </div>
                        <div class="me-item">
                            <i class="icon-cards"></i>
                            <span>卡包</span>
                            <i class="icon-arrow"></i>
                        </div>
                        <div class="me-item">
                            <i class="icon-sticker"></i>
                            <span>表情</span>
                            <i class="icon-arrow"></i>
                        </div>
                    </div>
                    <div class="me-section">
                        <div class="me-item">
                            <i class="icon-settings"></i>
                            <span>设置</span>
                            <i class="icon-arrow"></i>
                        </div>
                    </div>
                </div>


                <!-- 底部导航栏 -->
                <div class="tab-bar">
                    <div v-for="tab in tabs" :key="tab.id" class="tab-item" :class="{ 'active': currentTab === tab.id }"
                        @click="switchTab(tab.id)">
                        <i :class="tab.icon"></i>
                        <span>{{ tab.name }}</span>
                        <span v-if="tab.unread" class="badge">{{ tab.unread }}</span>
                        <span v-if="tab.hasNew" class="dot"></span>
                    </div>
                </div>




            </div>

            <!-- 聊天详情页面 -->
            <div class="page chat-page" :class="{ 'slide-in': showChat }">
                <div class="header">
                    <div class="back-button" @click="goBack">
                        <!-- 移除图标字体，使用 CSS 绘制的箭头 -->
                    </div>
                    <div class="title">{{ currentChat?.name }}</div>
                    <div class="icons">
                        <i class="icon-more"></i>
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-messages" v-if="currentChat && currentChat.messages && currentChat.messages.length">
                        <div v-for="msg in currentChat.messages" :key="msg.id" class="message-item" :class="{ 'self': msg.isSelf }">
                            <!-- 添加发送者头像 -->
                            <img :src="msg.isSelf ? 'https://api.dicebear.com/7.x/avataaars/svg?seed=User' : currentChat.avatar" class="message-avatar">
                            <!-- 消息内容容器 -->
                            <div class="message-content">
                                <img v-if="msg.type === 'image'" :src="msg.content" class="message-image" @click="previewImage(msg.content)">
                                <span v-else>{{ msg.content }}</span>
                            </div>
                        </div>
                    </div>
                    <div v-else class="message-hint">暂无聊天记录</div>
                </div>

                <!-- 修改聊天输入框区域 -->
                <div class="chat-input-area">
                    <div class="input-toolbar">
                        <label class="upload-btn">
                            <img src="./assert/add.png" alt="图片" class="icon-image">
                            <input type="file" accept="image/*" @change="handleImageSelect" multiple
                                style="display: none;">
                        </label>
                    </div>
                    <div class="input-box">
                        <input type="text" v-model="messageText" placeholder="输入消息..." @keyup.enter="sendMessage">
                        <div class="image-preview-container" v-if="selectedImages.length">
                            <div class="image-preview" v-for="(image, index) in selectedImages" :key="index">
                                <img :src="image" alt="预览图片">
                                <span class="icon-close" @click="cancelImage(index)"></span>
                            </div>
                        </div>
                    </div>

                    <button class="send-btn" :class="{ active: messageText.trim() || selectedImages.length }"
                        @click="sendMessage">发送</button>
                </div>
            </div>

            <!-- 联人详情页面 -->
            <div class="page contact-detail-page" :class="{ 'slide-in': showContactDetail }">
                <!-- 顶部导航栏 -->
                <div class="header">
                    <div class="back-button" @click="closeContactDetail">
                        <span class="back-arrow"></span>
                    </div>
                    <div class="title">详细资料</div>
                </div>

                <!-- 个人信息卡片 -->
                <div class="contact-detail-content">
                    <div class="info-card">
                        <div class="avatar-large">
                            <img :src="currentContact?.avatar" alt="头像">
                        </div>
                        <div class="info-main">
                            <div class="name">{{ currentContact?.name }}</div>
                            <div class="wxid">微信号：{{ currentContact?.wxid || 'wxid_' + currentContact?.name }}</div>
                        </div>
                    </div>

                    <!-- 详细信息列表 -->
                    <div class="detail-list">
                        <div class="detail-item">
                            <span class="label">备注</span>
                            <span class="value">{{ currentContact?.remark || '设置备注' }}</span>
                            <i class="icon-arrow"></i>
                        </div>
                        <div class="detail-item">
                            <span class="label">地区</span>
                            <span class="value">{{ currentContact?.region || '未设置' }}</span>
                        </div>
                    </div>
                </div>

                <!-- 底部操作钮 -->
                <div class="bottom-actions">
                    <div class="action-buttons">
                        <div class="action-btn" @click="startChat(currentContact)">
                            <div class="icon-wrapper">
                                <i class="icon-message"></i>
                            </div>
                            <span>发消息</span>
                        </div>
                        <div class="action-btn">
                            <div class="icon-wrapper">
                                <i class="icon-video"></i>
                            </div>
                            <span>视频通话</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 朋友圈页面 -->
            <div class="page moments-page" :class="{ 'slide-in': showMoments }">
                <!-- 朋友圈导航栏 -->
                <div class="moments-nav" :style="navStyle">
                    <div class="back-button" @click="closeMoments">
                        <i class="icon-back"></i>
                    </div>
                    <div class="title">朋友圈</div>
                    <img src="https://api.iconify.design/material-symbols:photo-camera-outline.svg" class="icon-camera"
                        @click="openCamera">
                </div>

                <!-- 朋友圈内容区域 -->
                <div class="moments-content">
                    <!-- 顶部背景区域 -->
                    <div class="moments-header">
                        <img class="moments-bg" src="https://picsum.photos/800/600" alt="朋友圈背景">
                        <div class="user-info-moments">
                            <div class="user-name-moments">我的名字</div>
                            <img class="user-avatar-moments" src="https://api.dicebear.com/7.x/avataaars/svg?seed=User"
                                alt="头像">
                        </div>
                    </div>

                    <!-- 朋友圈列表 -->
                    <div class="moments-list">
                        <div v-for="moment in moments" :key="moment.id" class="moment-item">
                            <div class="moment-header">
                                <img :src="moment.avatar" :alt="moment.name" class="moment-avatar">
                                <div class="moment-info">
                                    <div class="moment-name">{{ moment.name }}</div>
                                    <div class="moment-text">{{ moment.text }}</div>
                                    <div class="moment-images" v-if="moment.images && moment.images.length">
                                        <img v-for="(image, index) in moment.images" :key="index" :src="image"
                                            class="moment-image" @click="previewImage(moment.images, index)">
                                    </div>
                                    <div class="moment-footer">
                                        <span class="moment-time">{{ moment.time }}</span>
                                        <div class="moment-actions">
                                            <span class="moment-action">赞</span>
                                            <span class="moment-action">评论</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 简化的图片预览组件 -->
            <div class="image-preview-overlay" v-if="previewImages.length">
                <div class="preview-close" @click="closePreview">×</div>

                <div class="preview-container">
                    <img :src="previewImages[currentPreviewIndex]" class="preview-image" @click="nextImage"
                        @touchstart="handleTouchStart" @touchmove="handleTouchMove" @touchend="handleTouchEnd"
                        @mousedown="handleMouseDown" @mousemove="handleMouseMove" @mouseup="handleMouseUp"
                        @mouseleave="handleMouseUp">
                </div>

                <div class="preview-indicator">{{ currentPreviewIndex + 1 }}/{{ previewImages.length }}</div>
            </div>


            <!-- AI画一画页面 -->
            <div class="draw-page" :class="{ 'slide-in': showDrawPage }">
                <!-- 顶部导航 -->
                <div class="header">
                    <div class="back-button" @click="closeDrawPage"></div>
                    <div class="title">画一画</div>
                    <div class="right-placeholder"></div>
                </div>

                <!-- 模板选择 -->
                <div class="template-section">
                    <div class="template-title">选择模板</div>
                    <div class="template-list">
                        <div v-for="template in templates" 
                             :key="template.id"
                             class="template-item"
                             :class="{ active: currentTemplate === template.id }"
                             @click="selectTemplate(template.id)">
                            <div class="template-icon">
                                <img :src="template.icon" :alt="template.name">
                            </div>
                            <div class="template-name">{{template.name}}</div>
                        </div>
                    </div>
                </div>

                <!-- 提示词输入 -->
                <div class="prompt-section">
                    <div>输入提示词</div>
                    <div class="prompt-input">
                        <textarea 
                            v-model="prompt"
                            :placeholder="getPlaceholder()"
                            maxlength="1000">
                        </textarea>
                        <div class="word-count">{{ prompt.length }}/1000</div>
                    </div>
                </div>

                <!-- 参考图上传 - 仅在特定模板下显示 -->
                <div class="reference-section" v-if="showReferenceUpload">
                    <div>上传参考图</div>
                    <div class="upload-area">
                        <div v-for="(img, index) in referenceImages" 
                             :key="index" 
                             class="upload-item">
                            <img :src="img" class="upload-preview">
                            <div class="upload-remove" @click="removeImage(index)">×</div>
                        </div>
                        <div class="upload-item" v-if="referenceImages.length < maxImages" @click="uploadImage">
                            <i class="plus-icon"></i>
                        </div>
                    </div>
                </div>

                <!-- 生成按钮 -->
                <div class="generate-section">
                    <button class="generate-button" @click="generateImage">
                        <i class="icon-magic"></i>
                        <span>开始生成</span>
                    </button>
                </div>
            </div>




        </div>
    </div>



    <!-- Vue实例配置 -->
    <script>
        const { createApp } = Vue;

        const app = createApp({
            data() {
                return {
                    currentTab: 'wechat',
                    tabs: [
                        { id: 'wechat', name: '微信', icon: 'icon-chat' },
                        { id: 'contacts', name: '通讯录', icon: 'icon-contacts' },
                        { id: 'discover', name: '发现', icon: 'icon-discover' },
                        { id: 'me', name: '我', icon: 'icon-me' }
                    ],
                    messageText: '',
                    selectedImages: [],
                    imageFiles: [],
                    chats: [
                        {
                            id: 1,
                            name: '微信团队',
                            avatar: 'https://api.dicebear.com/7.x/bottts/svg?seed=wx-team',
                            lastMessage: '欢迎使用微信',
                            time: '12:00',
                            unread: 1,
                            isOfficial: true,
                            messages: [
                                {
                                    id: 1,
                                    type: 'text',
                                    content: '欢迎使用微信',
                                    isSelf: false,
                                    time: '12:00'
                                }
                            ]
                        },
                        {
                            id: 2,
                            name: '文件传输助手',
                            avatar: 'https://api.dicebear.com/7.x/bottts/svg?seed=file-helper',
                            lastMessage: '您的文件已发送成功',
                            time: '11:30',
                            unread: 0,
                            isSystem: true,
                            messages: [
                                {
                                    id: 1,
                                    type: 'text',
                                    content: '您的文件已发送成功',
                                    isSelf: false,
                                    time: '11:30'
                                }
                            ]
                        },
                        {
                            id: 3,
                            name: '产品开发群',
                            avatar: 'https://api.dicebear.com/7.x/initials/svg?seed=产品开发群',
                            lastMessage: 'Alice: 新功能已经上线了，大家可以测一下',
                            time: '10:45',
                            unread: 12,
                            isGroup: true,
                            messages: [
                                {
                                    id: 1,
                                    type: 'text',
                                    content: '新功能已经上线了，大家可以测试一下',
                                    isSelf: false,
                                    time: '10:45',
                                    sender: 'Alice'
                                }
                            ]
                        },
                        {
                            id: 4,
                            name: 'Alice',
                            avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Alice',
                            lastMessage: '好的，下午见',
                            time: '10:30',
                            unread: 0,
                            messages: [
                                {
                                    id: 1,
                                    type: 'text',
                                    content: '下有个会议需要讨论',
                                    isSelf: false,
                                    time: '10:25'
                                },
                                {
                                    id: 2,
                                    type: 'text',
                                    content: '好的，下午见',
                                    isSelf: true,
                                    time: '10:30'
                                }
                            ]
                        },
                        {
                            id: 5,
                            name: 'Bob',
                            avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Bob',
                            lastMessage: '项目进展如何？',
                            time: '09:15',
                            unread: 3,
                            messages: [
                                {
                                    id: 1,
                                    type: 'text',
                                    content: '项目进展如何？',
                                    isSelf: false,
                                    time: '09:15'
                                }
                            ]
                        },
                        {
                            id: 6,
                            name: '技术支持群',
                            avatar: 'https://api.dicebear.com/7.x/initials/svg?seed=技术支持群',
                            lastMessage: 'Tom: 服务器状态已恢复正常',
                            time: '09:00',
                            unread: 5,
                            isGroup: true,
                            messages: [
                                {
                                    id: 1,
                                    type: 'text',
                                    content: '服务状态已恢复常',
                                    isSelf: false,
                                    time: '09:00',
                                    sender: 'Tom'
                                }
                            ]
                        },
                        {
                            id: 7,
                            name: 'Emma',
                            avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Emma',
                            lastMessage: '周末一起去看电影吗？',
                            time: '昨天',
                            unread: 1,
                            messages: [
                                {
                                    id: 1,
                                    type: 'text',
                                    content: '周末一起去看电影吗？',
                                    isSelf: false,
                                    time: '昨天'
                                }
                            ]
                        },
                        {
                            id: 8,
                            name: '家庭群',
                            avatar: 'https://api.dicebear.com/7.x/initials/svg?seed=家庭群',
                            lastMessage: '妈妈：记得回家吃饭',
                            time: '昨天',
                            unread: 0,
                            isGroup: true,
                            messages: [
                                {
                                    id: 1,
                                    type: 'text',
                                    content: '记得回家吃饭',
                                    isSelf: false,
                                    time: '昨天',
                                    sender: '妈妈'
                                }
                            ]
                        },
                        {
                            id: 9,
                            name: 'Jack',
                            avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Jack',
                            lastMessage: '项目文档已更新',
                            time: '星期二',
                            unread: 0,
                            messages: [
                                {
                                    id: 1,
                                    type: 'text',
                                    content: '项目文档已更新',
                                    isSelf: false,
                                    time: '星期二'
                                }
                            ]
                        },
                        {
                            id: 10,
                            name: '同学会群',
                            avatar: 'https://api.dicebear.com/7.x/initials/svg?seed=同学会群',
                            lastMessage: 'Lisa: 下个月聚会时间定了吗？',
                            time: '星期一',
                            unread: 8,
                            isGroup: true,
                            messages: [
                                {
                                    id: 1,
                                    type: 'text',
                                    content: '下个月聚会时间定了吗？',
                                    isSelf: false,
                                    time: '星期一',
                                    sender: 'Lisa'
                                }
                            ]
                        }
                    ],
                    showChat: false,
                    currentChat: null,
                    showContactDetail: false,
                    currentContact: null,
                    letters: ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'],
                    contactSections: [
                        {
                            letter: 'A',
                            contacts: [
                                {
                                    id: 1,
                                    name: 'Alice',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Alice',
                                    region: '广东 深圳'
                                },
                                {
                                    id: 2,
                                    name: 'Amy',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Amy',
                                    region: '北京'
                                },
                                {
                                    id: 3,
                                    name: 'Alex',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Alex',
                                    region: '上海'
                                }
                            ]
                        },
                        {
                            letter: 'B',
                            contacts: [
                                {
                                    id: 4,
                                    name: 'Bob',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Bob',
                                    region: '上海'
                                },
                                {
                                    id: 5,
                                    name: 'Bill',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Bill',
                                    region: '广东 广州'
                                },
                                {
                                    id: 6,
                                    name: 'Bruce',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Bruce',
                                    region: '浙江 杭州'
                                }
                            ]
                        },
                        {
                            letter: 'C',
                            contacts: [
                                {
                                    id: 7,
                                    name: 'Cindy',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Cindy',
                                    region: '浙江 杭州'
                                },
                                {
                                    id: 8,
                                    name: 'Chris',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Chris',
                                    region: '江苏 南京'
                                }
                            ]
                        },
                        {
                            letter: 'D',
                            contacts: [
                                {
                                    id: 9,
                                    name: 'David',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=David',
                                    region: '四川 成都'
                                },
                                {
                                    id: 10,
                                    name: 'Daniel',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Daniel',
                                    region: '湖北 武汉'
                                }
                            ]
                        },
                        {
                            letter: 'L',
                            contacts: [
                                {
                                    id: 11,
                                    name: 'Lucy',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Lucy',
                                    region: '福建 厦门'
                                },
                                {
                                    id: 12,
                                    name: 'Linda',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Linda',
                                    region: '山东 青岛'
                                }
                            ]
                        },
                        {
                            letter: 'M',
                            contacts: [
                                {
                                    id: 13,
                                    name: 'Mike',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Mike',
                                    region: '江西 南昌'
                                },
                                {
                                    id: 14,
                                    name: 'Mary',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Mary',
                                    region: '安徽 合肥'
                                }
                            ]
                        },
                        {
                            letter: 'S',
                            contacts: [
                                {
                                    id: 15,
                                    name: 'Sarah',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah',
                                    region: '重庆'
                                },
                                {
                                    id: 16,
                                    name: 'Steve',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Steve',
                                    region: '天津'
                                }
                            ]
                        },
                        {
                            letter: 'W',
                            contacts: [
                                {
                                    id: 17,
                                    name: 'William',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=William',
                                    region: '河北 石家庄'
                                },
                                {
                                    id: 18,
                                    name: 'Wendy',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Wendy',
                                    region: '西 西安'
                                }
                            ]
                        },
                        {
                            letter: 'Z',
                            contacts: [
                                {
                                    id: 19,
                                    name: 'Zack',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Zack',
                                    region: '湖南 长沙'
                                },
                                {
                                    id: 20,
                                    name: 'Zoey',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Zoey',
                                    region: '云南 昆明'
                                }
                            ]
                        }
                    ],
                    searchText: '', // 搜索文本
                    searchResults: [], // 搜索结果
                    showMoments: false,
                    isNavScrolled: false,
                    moments: [
                        {
                            id: 1,
                            name: "张三",
                            avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Alice",
                            text: "今天天气真好 ☀️",
                            images: [
                                "https://picsum.photos/300/300?random=1",
                                "https://picsum.photos/300/300?random=2",
                                "https://picsum.photos/300/300?random=3"
                            ],
                            time: "5分钟前"
                        },
                        {
                            id: 2,
                            name: "李四",
                            avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Bob",
                            text: "分享一个有趣的项目 🚀",
                            images: [
                                "https://picsum.photos/300/300?random=4"
                            ],
                            time: "10分钟前"
                        },
                        {
                            id: 3,
                            name: "小明",
                            avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Charlie",
                            text: "周末去爬山，风景真美 🏔️",
                            images: [
                                "https://picsum.photos/300/300?random=5",
                                "https://picsum.photos/300/300?random=6",
                                "https://picsum.photos/300/300?random=7",
                                "https://picsum.photos/300/300?random=8"
                            ],
                            time: "1小时前"
                        },
                        {
                            id: 4,
                            name: "小红",
                            avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=David",
                            text: "新买的相机，随手拍几张 📸",
                            images: [
                                "https://picsum.photos/300/300?random=9",
                                "https://picsum.photos/300/300?random=10"
                            ],
                            time: "2小时前"
                        },
                        {
                            id: 5,
                            name: "王五",
                            avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Eva",
                            text: "美食分享 🍜",
                            images: [
                                "https://picsum.photos/300/300?random=11",
                                "https://picsum.photos/300/300?random=12",
                                "https://picsum.photos/300/300?random=13",
                                "https://picsum.photos/300/300?random=14",
                                "https://picsum.photos/300/300?random=15"
                            ],
                            time: "3小时前"
                        },
                        {
                            id: 6,
                            name: "小李",
                            avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Frank",
                            text: "工作日常 💼",
                            time: "4小时前"
                        },
                        {
                            id: 7,
                            name: "小张",
                            avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=George",
                            text: "新到的咖啡豆，香气四溢 ☕️",
                            images: [
                                "https://picsum.photos/300/300?random=16"
                            ],
                            time: "5小时前"
                        },
                        {
                            id: 8,
                            name: "小王",
                            avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Henry",
                            text: "读书打卡第100天 📚",
                            time: "6小时前"
                        },
                        {
                            id: 9,
                            name: "小陈",
                            avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Ivy",
                            text: "看展览的一天 🎨",
                            images: [
                                "https://picsum.photos/300/300?random=17",
                                "https://picsum.photos/300/300?random=18",
                                "https://picsum.photos/300/300?random=19"
                            ],
                            time: "8小时前"
                        },
                        {
                            id: 10,
                            name: "小林",
                            avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Jack",
                            text: "新学期开始了 📝",
                            images: [
                                "https://picsum.photos/300/300?random=20",
                                "https://picsum.photos/300/300?random=21"
                            ],
                            time: "10小时前"
                        }
                    ],
                    scrollTop: 0,  // 添加滚动位置记录
                    previewImages: [], // 预览图片数组
                    currentPreviewIndex: 0, // 当前预览的图片索引
                    startX: 0,
                    endX: 0,
                    isDragging: false,
                    isMoved: false,

                    /*画一画*/
                    showDrawPage: false,
                    drawPrompt: '',
                    similarity: 75,
                    currentStyle: '推荐',
                    styles: ['推荐', '动漫', '创意艺术', '人物写实', '更多'],
                    templates: [
                        { 
                            id: 'all', 
                            name: '全能',
                            icon: 'https://api.iconify.design/material-symbols:auto-awesome.svg?color=%238E5CFF',
                            placeholder: '请描述您想要的画面，例如：星空下的城市夜景，霓虹灯闪烁'
                        },
                        { 
                            id: 'photo', 
                            name: '写真',
                            icon: 'https://api.iconify.design/material-symbols:photo-camera.svg?color=%238E5CFF',
                            placeholder: '请描述人物特征和场景，例如：年轻女孩，白色连衣裙，樱花林'
                        },
                        { 
                            id: 'interior', 
                            name: '装修',
                            icon: 'https://api.iconify.design/material-symbols:chair.svg?color=%238E5CFF',
                            placeholder: '请描述装修风格和空间，例如：现代简约客厅，大落地窗，灰白色调'
                        },
                        { 
                            id: 'commerce', 
                            name: '电商',
                            icon: 'https://api.iconify.design/material-symbols:shopping-bag.svg?color=%238E5CFF',
                            placeholder: '请描述商品展示需求，例如：白色陶瓷咖啡杯，简约风格产品图'
                        },
                        { 
                            id: 'ad', 
                            name: '广告',
                            icon: 'https://api.iconify.design/material-symbols:ads-click.svg?color=%238E5CFF',
                            placeholder: '请描述广告创意，例如：运动鞋广告，充满动感，年轻活力'
                        }
                    ],
                    currentTemplate: 'all',
                    prompt: '',
                    referenceImages: [],
                    maxImages: 4,
                    showReferenceUpload: false
                }
            },
            methods: {
                switchTab(tabId) {
                    this.currentTab = tabId;
                },
                openChat(chat) {
                    this.currentChat = chat;
                    this.showChat = true;

                    // 清除未读消息提醒
                    if (chat.unread) {
                        chat.unread = 0;  // 将未读消息数重置为0
                    }

                    // 滚动到底部
                    this.$nextTick(() => {
                        const chatContent = document.querySelector('.chat-content');
                        if (chatContent) {
                            chatContent.scrollTop = chatContent.scrollHeight;
                        }
                    });
                },
                goBack() {
                    // 关闭聊天页面
                    this.showChat = false;
                    this.currentChat = null;
                    // 直接切换到微信标签页
                    this.currentTab = 'wechat';
                },
                handleImageSelect(event) {
                    const files = Array.from(event.target.files);
                    files.forEach(file => {
                        if (file) {
                            this.imageFiles.push(file);
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                this.selectedImages.push(e.target.result);
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                    event.target.value = '';
                },
                cancelImage(index) {
                    this.selectedImages.splice(index, 1);
                    this.imageFiles.splice(index, 1);
                },
                sendMessage() {
                    if (!this.currentChat) {
                        console.warn('No current chat selected');
                        return;
                    }

                    if (!this.currentChat.messages) {
                        this.currentChat.messages = [];
                    }

                    if (this.messageText.trim() || this.selectedImages.length) {
                        if (this.messageText.trim()) {
                            const textMessage = {
                                id: Date.now(),
                                type: 'text',
                                content: this.messageText,
                                isSelf: true,
                                time: new Date().toLocaleTimeString()
                            };
                            this.currentChat.messages.push(textMessage);
                            // 更新最后一息
                            this.currentChat.lastMessage = this.messageText;
                            this.currentChat.time = new Date().toLocaleTimeString();
                        }

                        this.selectedImages.forEach((image, index) => {
                            const imageMessage = {
                                id: Date.now() + index + 1,
                                type: 'image',
                                content: image,
                                isSelf: true,
                                time: new Date().toLocaleTimeString()
                            };
                            this.currentChat.messages.push(imageMessage);
                            // 如果是最后一张图片，更新最后一条消息
                            if (index === this.selectedImages.length - 1) {
                                this.currentChat.lastMessage = '[图片]';
                                this.currentChat.time = new Date().toLocaleTimeString();
                            }
                        });

                        this.messageText = '';
                        this.selectedImages = [];
                        this.imageFiles = [];

                        this.$nextTick(() => {
                            const chatContent = document.querySelector('.chat-content');
                            if (chatContent) {
                                chatContent.scrollTop = chatContent.scrollHeight;
                            }
                        });
                    }
                },
                openContactDetail(contact) {
                    this.currentContact = contact;
                    this.showContactDetail = true;
                },
                closeContactDetail() {
                    this.showContactDetail = false;
                    this.selectedContact = null;
                    // 返回到微信标签页
                    this.activeTab = 'chats';
                },
                startChat(contact) {
                    this.closeContactDetail();
                    let chat = this.chats.find(c => c.id === contact.id);
                    if (!chat) {
                        chat = {
                            id: contact.id,
                            name: contact.name,
                            avatar: contact.avatar,
                            lastMessage: '',
                            time: new Date().toLocaleTimeString()
                        };
                        this.chats.unshift(chat);
                    }
                    this.openChat(chat);
                },
                scrollToLetter(letter) {
                    const element = document.querySelector(`[data-letter="${letter}"]`);
                    if (element) {
                        const container = document.querySelector('.contact-list');
                        const containerRect = container.getBoundingClientRect();
                        const elementRect = element.getBoundingClientRect();
                        const offset = elementRect.top - containerRect.top;

                        container.scrollTo({
                            top: container.scrollTop + offset - 60, // 考虑顶部固定区域高度
                            behavior: 'smooth'
                        });
                    }
                },
                handleLetterTouchStart(event, letter) {
                    event.preventDefault();
                    this.scrollToLetter(letter);
                },
                receiveMessage(chatId, message) {
                    const chat = this.chats.find(c => c.id === chatId);
                    if (chat) {
                        if (!chat.messages) {
                            chat.messages = [];
                        }
                        chat.messages.push(message);
                        chat.lastMessage = message.content;
                        chat.time = new Date().toLocaleTimeString();

                        // 如果不是当前聊天，增加未读消息数
                        if (this.currentChat?.id !== chat.id) {
                            chat.unread = (chat.unread || 0) + 1;
                        }
                    }
                },
                // 处理搜索
                handleSearch() {
                    if (!this.searchText) {
                        this.searchResults = [];
                        return;
                    }

                    this.searchResults = this.contactSections.reduce((results, section) => {
                        return results.concat(section.contacts.filter(contact => contact.name.toLowerCase().includes(this.searchText.toLowerCase())));
                    }, []);
                },
                openMoments() {
                    this.showMoments = true;
                    this.showChat = false;
                    this.isNavWhite = false; // 重置导航栏状态
                },

                closeMoments() {
                    this.showMoments = false;
                },

                openCamera() {
                    // 实现拍照功能
                    console.log('打开机');
                },

                previewImage(images, index = 0) {
                    // 如果传入的是单张片，将其转换为数组
                    this.previewImages = Array.isArray(images) ? images : [images];
                    this.currentPreviewIndex = index;

                    // 禁止背景滚动
                    document.body.style.overflow = 'hidden';
                },
                closePreview() {
                    this.previewImages = [];
                    this.currentPreviewIndex = 0;

                    // 恢复背景滚动
                    document.body.style.overflow = 'auto';
                },
                testClick() {
                    console.log('点击了朋友圈');
                },
                nextImage() {
                    if (this.currentPreviewIndex < this.previewImages.length - 1) {
                        this.currentPreviewIndex++;
                    } else {
                        this.currentPreviewIndex = 0; // 循环到第一张
                    }
                },
                handleTouchStart(event) {
                    this.startX = event.touches[0].clientX;
                    this.isDragging = true;
                    this.isMoved = false; // 添加移动标记
                },
                handleTouchMove(event) {
                    if (this.isDragging) {
                        event.preventDefault();
                        this.isMoved = true; // 标记已经移动
                    }
                },
                handleTouchEnd(event) {
                    if (!this.isDragging) return;

                    // 只有发生了移动才处理滑动
                    if (this.isMoved) {
                        this.endX = event.changedTouches[0].clientX;
                        this.handleSwipe();
                    }

                    this.isDragging = false;
                    this.isMoved = false;
                },
                handleMouseDown(event) {
                    this.startX = event.clientX;
                    this.isDragging = true;
                    this.isMoved = false; // 添加移动标记
                },
                handleMouseMove(event) {
                    if (this.isDragging) {
                        event.preventDefault();
                        this.isMoved = true; // 标记已经移动
                    }
                },
                handleMouseUp(event) {
                    if (!this.isDragging) return;

                    // 只有发生了移动才处理滑动
                    if (this.isMoved) {
                        this.endX = event.clientX;
                        this.handleSwipe();
                    }

                    this.isDragging = false;
                    this.isMoved = false;
                },
                handleSwipe() {
                    const swipeDistance = this.startX - this.endX;

                    if (Math.abs(swipeDistance) > 5) {
                        if (swipeDistance > 0) {
                            // 向左滑动，显示下一张
                            this.nextImage();
                        } else {
                            // 向右滑动，显示上一张
                            if (this.currentPreviewIndex > 0) {
                                this.currentPreviewIndex--;
                            } else {
                                this.currentPreviewIndex = this.previewImages.length - 1;
                            }
                        }
                    }
                },

                /*画一画*/
                openDrawPage() {
                    this.showDrawPage = true;
                },
                closeDrawPage() {
                    this.showDrawPage = false;
                },
                clearPrompt() {
                    this.drawPrompt = '';
                },
                generateImage() {
                    // 实现图片生成逻辑
                    console.log('Generating image with:', {
                        template: this.currentTemplate,
                        prompt: this.prompt,
                        referenceImages: this.referenceImages
                    });
                },
                // 获取当前模板的提示文本
                getPlaceholder() {
                    const template = this.templates.find(t => t.id === this.currentTemplate);
                    return template ? template.placeholder : '请输入您想要实现的画面内容...';
                },
                // 选择模板
                selectTemplate(templateId) {
                    this.currentTemplate = templateId;
                    // 根据模板类型决定是否显示参考图上传
                    this.showReferenceUpload = ['photo', 'interior'].includes(templateId);
                },
                // 上传图片
                uploadImage() {
                    // 实现图片上传逻辑
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = 'image/*';
                    input.onchange = (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                this.referenceImages.push(e.target.result);
                            };
                            reader.readAsDataURL(file);
                        }
                    };
                    input.click();
                },
                // 移除图片
                removeImage(index) {
                    this.referenceImages.splice(index, 1);
                }
            },
            computed: {
                getCurrentTabName() {
                    const currentTab = this.tabs.find(tab => tab.id === this.currentTab);
                    return currentTab ? currentTab.name : '信';
                }
            }
        });

        app.mount('#app');
    </script>
</body>

</html>